# @TEST-EXEC: printf 12345A12345B12345C | spicy-driver -d %INPUT >output
# @TEST-EXEC: btest-diff output
#
# @TEST-DOC: Check that foreach-hooks execute before a &while condition is evaluated.

module Test;

type subtype = unit {
    x: bytes &size=5;
    y: int8;
};

public type test = unit {
    element: subtype()[] &while=self.continue_parsing foreach {
        if ( $$.y == 'C' ) {
            self.continue_parsing = False ;
        }
    }

    var continue_parsing: bool = True;

    on %done { print self; }
};
